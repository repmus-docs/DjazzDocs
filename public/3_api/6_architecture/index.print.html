<!DOCTYPE html>
<html lang="en" dir="ltr" itemscope itemtype="http://schema.org/Article">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.129.0">
    <meta name="generator" content="Relearn 6.0.0+tip">
    <meta name="description" content="Because Djazz is beat-based, most objects are built to receive and process information at recurring instances.">
    <meta name="author" content="Daniel Brown">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="http://localhost:1313/images/hero.png">
    <meta name="twitter:title" content="System Architecture :: Hugo Relearn Theme">
    <meta name="twitter:description" content="Because Djazz is beat-based, most objects are built to receive and process information at recurring instances.">
    <meta property="og:url" content="http://localhost:1313/3_api/6_architecture.html">
    <meta property="og:site_name" content="Hugo Relearn Theme">
    <meta property="og:title" content="System Architecture :: Hugo Relearn Theme">
    <meta property="og:description" content="Because Djazz is beat-based, most objects are built to receive and process information at recurring instances.">
    <meta property="og:locale" content="en">
    <meta property="og:type" content="website">
    <meta property="og:image" content="http://localhost:1313/images/hero.png">
    <meta itemprop="name" content="System Architecture :: Hugo Relearn Theme">
    <meta itemprop="description" content="Because Djazz is beat-based, most objects are built to receive and process information at recurring instances.">
    <meta itemprop="wordCount" content="16">
    <meta itemprop="image" content="http://localhost:1313/images/hero.png">
    <title>System Architecture :: Hugo Relearn Theme</title>
    <link href="http://localhost:1313/3_api/6_architecture.html" rel="canonical" type="text/html" title="System Architecture :: Hugo Relearn Theme">
    <link href="../../3_api/6_architecture/index.xml" rel="alternate" type="application/rss+xml" title="System Architecture :: Hugo Relearn Theme">
    <link href="../../css/fontawesome-all.min.css?1735333767" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../css/fontawesome-all.min.css?1735333767" rel="stylesheet"></noscript>
    <link href="../../css/nucleus.css?1735333767" rel="stylesheet">
    <link href="../../css/auto-complete.css?1735333767" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../css/auto-complete.css?1735333767" rel="stylesheet"></noscript>
    <link href="../../css/perfect-scrollbar.min.css?1735333767" rel="stylesheet">
    <link href="../../css/fonts.css?1735333767" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../css/fonts.css?1735333767" rel="stylesheet"></noscript>
    <link href="../../css/theme.css?1735333767" rel="stylesheet">
    <link href="../../css/theme-relearn-auto.css?1735333767" rel="stylesheet" id="R-variant-style">
    <link href="../../css/chroma-relearn-auto.css?1735333767" rel="stylesheet" id="R-variant-chroma-style">
    <link href="../../css/variant.css?1735333767" rel="stylesheet">
    <link href="../../css/print.css?1735333767" rel="stylesheet" media="print">
    <link href="../../css/format-print.css?1735333767" rel="stylesheet">
    <script src="../../js/variant.js?1735333767"></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.relBasePath='..';
      window.relearn.relBaseUri='..';
      window.relearn.absBaseUri='http:\/\/localhost:1313';
      window.index_js_url="../../index.search.js?1735333767";
      // variant stuff
      window.variants && variants.init( [ 'relearn-auto', 'relearn-light', 'relearn-dark', 'relearn-bright', 'zen-auto', 'zen-light', 'zen-dark', 'retro-auto', 'neon', 'learn', 'blue', 'green', 'red' ] );
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
    </script>
    <style>
      #R-body img.bg-white {
        background-color: white;
      }
    </style>
  </head>
  <body class="mobile-support print disableInlineCopyToClipboard" data-url="../../3_api/6_architecture.html">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="disable" data-width-s="show" data-width-m="hide" data-width-l="hide"><button class="topbar-control" onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)"><i class="fa-fw fas fa-bars"></i></button>
            </div>
          </div>
          <ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype="http://schema.org/BreadcrumbList"><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="../../3_api.html"><span itemprop="name">API</span></a><meta itemprop="position" content="1">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><span itemprop="name">System Architecture</span><meta itemprop="position" content="2"></li>
          </ol>
          <div class="topbar-area topbar-area-end" data-area="end">
            <div class="topbar-button topbar-button-prev" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="../../3_api/5_improvisation/5_listener.html" title="Listener (ü°ê)"><i class="fa-fw fas fa-chevron-left"></i></a>
            </div>
            <div class="topbar-button topbar-button-next" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="../../3_api/6_architecture/component_descriptions/master_control.html" title="main components (ü°í)"><i class="fa-fw fas fa-chevron-right"></i></a>
            </div>
          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <article class="default">
            <header class="headline">
            </header>

<h1 id="system-architecture">System Architecture</h1>

<p>Because Djazz is beat-based, most objects are built to receive and process information at recurring instances.</p>

            <footer class="footline">
            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of System Architecture</h1>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="main-components">main components</h1>

<p>Description of Components in Model:</p>
<p>Master Control
Master Clock
- outputs a beat number when it receives a bang
- increments its beat number with each output, but also keeps track of position in a song form and adjusts the beat in accordance if looped.
- keeps track of tempo if tempo is manually input and fluctuates. This uses antescofo.
- reads from song dict to get label
- sends tempo, beat, and chord label, immediately in succession and in that order, to midi and audio generators. This order is important,  so that the generators can calculate the correct information to play at the beginning of each beat.</p>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="control-flow">control flow</h1>


<pre class="mermaid align-left zoomable">
graph TB;
    A[Master Clock] 
	B[Audio]
	C[MIDI]
	A--&gt;|tempo, beat number, label| B
	A--&gt;|tempo, beat number, label| C
</pre>

<pre class="mermaid align-left zoomable">
flowchart TB;
gIn(( ))
g1[Generator 1]
g2[Generator 2]
g3[Generator 3]
g4[Generator 4]
g5[Generator 5]

mbPlayer[MIDI Beat Player]

t1[MIDI\nTrack 1]
t2[MIDI\nTrack 2]
t3[MIDI\nTrack 3]
t4[MIDI\nTrack 4]
t5[MIDI\nTrack 5]

gOut((( )))

gIn --&gt; g1 --&gt; mbPlayer
gIn --&gt; g2 --&gt; mbPlayer
gIn --&gt; g3 --&gt; mbPlayer
gIn --&gt; g4 --&gt; mbPlayer
gIn --&gt; g5 --&gt; mbPlayer

mbPlayer --&gt; t1 --&gt; gOut
mbPlayer --&gt; t2 --&gt; gOut
mbPlayer --&gt; t3 --&gt; gOut
mbPlayer --&gt; t4 --&gt; gOut
mbPlayer --&gt; t5 --&gt; gOut

</pre>
<p>Because Djazz is beat-based, most objects are built to receive and process information at recurring instances.</p>
<p>Djazz plays music in two ways: by selecting sections from scores, and by calculating improvisations using the factor oracle algorithm. The factor oracle algorithm can be modified with pattern-matching methods. The input to the factor oracle come from scores and real-time input, either audio or MIDI, and is output as audio or MIDI. It uses Antescofo to generate notes both from scores and generated as improvisations in tempo.</p>
<p>Djazz improvises on songs using template files, which are lists of beats with labels representing positions in the songs.  Notes are in different files: scores and audio tags in the databases used by the factor oracle.</p>
<p>The song templates pass the label to the factor oracle know given time.  For songs whose formal structure includes verses or sections, this larger structure is also included in the template. It can also improvise over a ‚Äúfree‚Äù structure by using a trivial template, just a short list of beats that loops.</p>
<p>Djazz is played by inputting a tap‚Äîmanually, from a built-in metronome, or from another application. The tap triggers a beat, which triggers notes to be output from the factor oracle or the score, which triggers note data to be output from antescofo, which triggers sound to be output by the audio or midi outputs. [SLIDE]</p>
<p>You can see this control flow. The tap comes in on the left and comes out as sound from the midi bank on the right. The intermediate translations from tap to beat occur in the objects along the way.
The architecture: several players which function independently. There is a master control for synchronising timing and for broadcasting global commands.</p>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="overview-of-mvvcc-model-view-view-controller-view-architecture">Overview of MVVCC (Model-View-View Controller-View) Architecture</h1>

<pre><code>1. Architecture
	Model/Control/View Control/View
</code></pre>
<p>MVC:</p>
<p>Djazz uses the Model-View-Control design pattern.</p>
<p>The model consists of the objects that do the processing. At the top level, there are various players and the master control described in the previous section.</p>
<p>The model is controlled entirely by passing named pattrs in the message format <variable-name> <variable-value>. These parameters are received in the leftmost inlet.</p>
<p>The control is</p>
<p>The view is</p>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="pattr-usage">Pattr usage</h1>

<p>Input is passed to patchers two ways: synchronously and asynchronously, depending on the type of input data.
Synchoronous data consists of the beat number, the current tempo (since this can fluctuate), and any data to be used by the analyzer.
This data is passed serially through patch cords which send data serially.</p>
<p>Asynchoronous data is anything changed by the user using the GUI. A lot of this data is well known to audio interface users: track volume,
MIDI and audio effects like pitch transposition, for instance.</p>
<p>Pattr translation in control and view control</p>
<p>Interface - not much to say. Just graphical controls.
Sends and receives pattrs to and from control. Infinite loop is avoided via pattrstorage output mode set to 5.</p>
<p>The CONTROL PATTRS and DATA PATTRS (dicts) are saved.
On loading, the data pattrs must be fully loaded first; their priorities are set to 1.
The control pattrs are independent so their priorities are all 0.</p>
<p>Every parameter is stored in a pattr object.</p>
<p>As an example, here is a midi player object, which contains, among other components, a beat clock. The beat clock itself contains several components. Here we see one of them, ¬´¬†loop_section¬†¬ª and the pattr objects it contains. [SLIDE]</p>
<p>The pattrhub object invokes them, so a message ‚Äústep 2‚Äù will set the step pattr object in beat_clock to 2.</p>
<p>Pattrs act hierarchically. The beat clock is named ‚Äúbeat_clock‚Äù [SLIDE], so the step variable can be invoked by sending the beat clock the message ‚Äúbeat_clock::step 2.‚Äù This double-colon format continues as the pattr object is nested in deeper levels of a hierarchy.</p>
<p>The control consists of bpatchers. No bpatchers are in the model. These handle all the user interface logic like buttons and file selection. To change a parameter in the model, a pattr object must exist in the view with the same name as the corresponding one in the model. These names don‚Äôt conflict because they are in different sub patchers.</p>
<p>A pattrstorage object in the control keeps track of pattern changes. When the outputmode attribute is non-zero, it will send the names and values of changed parameters out its outlet.  Hence, to communicate parameter changes to the model, the pattrstorage output is sent out the control and into a pattrthub object at the top level of the model, which then broadcasts the changes to the proper places.</p>
<p>Note: with this method, the interior pattrhub objects end up not being used at all, but it‚Äôs still good to leave them in so that these objects can be reused and are not dependent on being called this way.</p>
<p>The hierarchical nature of the model, though, means that the parameter names sent from the control must have the same hierarchical structure as those in the model. Thus to control the ‚Äúmidi_player_1::beat_clock::loop_length‚Äù parameter, there must be a control bpatcher called ‚Äúmidi_player_1‚Äù that contains a bpatcher ‚Äúbeat_clock‚Äù that contains a pattr ‚Äúloop_length.‚Äù</p>
<pre><code>For smaller systems, this could be a good method: the control and the model are parallel hierarchies.
</code></pre>
<p>There are three problems with this method, though. The separation of model and control is supposed to give you the freedom to design the control without worrying about how things are being processed inside the model.</p>
<ol>
<li>
<p>The control architecture is completely linked to the model architecture, which becomes very constraining, especially as the control logic in a complicated system probably does not reflect the way things are processed.</p>
</li>
<li>
<p>You don‚Äôt necessarily want to control all the pattrs in the model. Some you might find unnecessary. This is not a big problem, but there is another related one:</p>
</li>
<li>
<p>Some pattrs in the model are not actually independent of each other at runtime.    Objects were created independently, but their functions in the system are dependent on each other or other objects</p>
</li>
</ol>
<p>It‚Äôs useful to design objects by thinking of their function independently of other objects, even though in the system they will not be independent.</p>
<p>For example:</p>
<p>There is an object that outputs a given number of bangs at a given tempo: it has two pattrs, ‚Äútempo‚Äù and ‚Äúcount‚Äù: the number of bangs to output.</p>
<p>There is another object that changes the system tempo.</p>
<p>The tempo object can be used to adjust the tempo by itself. But it is also used to control a parameter called ‚Äúspeed.‚Äù
Speed makes the musical output play twice as fast (double time), or in triplets, etc. Changing the speed to two means both doubling the tempo and setting the number of bangs to two.</p>
<p>Thus the mapping from control pattrs to model pattrs is not one-to-one. We can imagine more complicated networks of dependencies among model parameters that we don‚Äôt want to reflect in the control.</p>
<p>It‚Äôs useful to design these two objects separately because they can then be tested and maybe reused later. We end up with a model that is ‚Äúfeature-rich,‚Äù and the job is now to decide which features we want to use, and how they will be reflected in the control.</p>
<p>Note: In terms of domain-driven design, it‚Äôs important not to spend too much time building objects that do lots of things that we may not ultimately care about using. We‚Äôre not building a library, we‚Äôre building an application. On the other hand, building separate small objects that handle specific independent functions is a useful way to make building blocks for our application. So there‚Äôs a trade-off: designing for the application with an eye for the kind of independent and reusable objects that will make up a library.</p>
<p>To address these three problems, Djazz uses the following method:</p>
<p>For each important object that is made up of smaller components containing pattrs, like the ‚Äúmidi player,‚Äù there is a parameter bank. [SLIDE] This bank consists only of the surface pattrs that the control will call.</p>
<p>The midi player and the parameter bank are wrapped in a larger object, and parameters from the bank are passed to the midi player through a translator object.</p>
<p>This translator handles the three problems above. It translates the surface parameters to their corresponding hierarchically named pattrs, which is very easy. In this object, too, are placed the objects that translate control variables into dependent model variables, like f(speed)‚Äî&gt;[bang_count, tempo].
Finally, unused variables simply aren‚Äôt called. But to be absolutely sure that uncalled variables don‚Äôt give us trouble, by storing state that have forgotten about, or by accidentally being called, due to sharing names accidentally with a control variable, we can turn off their visibility to the pattrstorage system, which means they can never be called. There is a javascript object I wrote which will turn off all the pattrs in an object. The first argument tells it what the visibility is, the second weather to recursively change the visibility in sub patchers. [EXAMPLE]</p>
<pre><code>Now, in the control bpatcher, there is a similar parameter bank. Now the architectures of the control and the model are separate, and we are free to design the control as we want. As long as our controls send a message to the parameter bank with the right name, it will be sent to the model. [SLIDE] Now we can set up the controls as we like, and all the control logic‚Äîbutton operation, etc.‚Äîis completely independent of anything that happens in the model, and vice versa.
</code></pre>
<p>Because the pattrstorage object is inside the view, the namespace ‚Äúview‚Äù is not included in parameter names.</p>
<p>The model outputs midi and audio, but it also outputs pattrs to any view that wants to receive them. It does this the same way as the control: a pattrstorage object is at the top level of the model patcher, and when a pattr value is updated, it outputs the pattr name and value.
There are two types of pattrs that the model outputs: those that are specifically for a view, and the parameters that were sent from the control.
[SLIDE]
Because the control is the view, this flow of pattrs becomes a loop. [SLIDE] The control/view pattrstorage sends values to the model‚Äôs pattrhub, and the model pattrstorage send values to the control/view‚Äôs pattrhub</p>
<p>To avoid an infinite loop, we make use the pattrstorage‚Äôs outputmode attribute.</p>
<p>In the model, the output mode is 2: any changed values are sent out.
But in the view, the output mode is 6: values that are changed by objects in the pattr system are not sent out. That is, only values that are changed by user interaction are sent out. Thus the values received by pattrhub are set but not passed on. The loop is broken. [SLIDE]</p>
<p>The control flow is clear
All of the state is centralised in the parameter banks
The state can be read in in real time by the client windows (easy to debug)
The state can be saved as preset files and reloaded.</p>

            <footer class="footline">
            </footer>
          </article>

          </section>
        </div>
      </main>
    </div>
    <script src="../../js/clipboard.min.js?1735333767" defer></script>
    <script src="../../js/perfect-scrollbar.min.js?1735333767" defer></script>
    <script src="../../js/d3/d3-color.min.js?1735333767" defer></script>
    <script src="../../js/d3/d3-dispatch.min.js?1735333767" defer></script>
    <script src="../../js/d3/d3-drag.min.js?1735333767" defer></script>
    <script src="../../js/d3/d3-ease.min.js?1735333767" defer></script>
    <script src="../../js/d3/d3-interpolate.min.js?1735333767" defer></script>
    <script src="../../js/d3/d3-selection.min.js?1735333767" defer></script>
    <script src="../../js/d3/d3-timer.min.js?1735333767" defer></script>
    <script src="../../js/d3/d3-transition.min.js?1735333767" defer></script>
    <script src="../../js/d3/d3-zoom.min.js?1735333767" defer></script>
    <script src="../../js/js-yaml.min.js?1735333767" defer></script>
    <script src="../../js/mermaid.min.js?1735333767" defer></script>
    <script>
      window.themeUseMermaid = JSON.parse("{ \"securityLevel\": \"loose\" }");
    </script>
    <script src="../../js/theme.js?1735333767" defer></script>
  </body>
</html>
